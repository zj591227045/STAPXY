# ç®¡ç†æ§åˆ¶å°ä½¿ç”¨æŒ‡å—

## ğŸ¯ æ¦‚è¿°

é™æ€Webä»£ç†ç³»ç»Ÿç°åœ¨æ”¯æŒç‹¬ç«‹çš„ç®¡ç†æ§åˆ¶å°åŸŸåï¼Œé¿å…ä¸ä»£ç†ç½‘ç«™äº§ç”Ÿå†²çªã€‚ç®¡ç†æ§åˆ¶å°æä¾›äº†å®Œæ•´çš„ç³»ç»Ÿç®¡ç†åŠŸèƒ½ï¼ŒåŒ…æ‹¬ç™»å½•è®¤è¯ã€çŠ¶æ€ç›‘æ§ã€é…ç½®ç®¡ç†ç­‰ã€‚

## ğŸ”§ é…ç½®è¯´æ˜

### ç®¡ç†åŸŸåé…ç½®

åœ¨ `config/config.json` ä¸­é…ç½®ç®¡ç†æ§åˆ¶å°çš„ä¸“ç”¨åŸŸåï¼š

```json
{
  "admin": {
    "password": "your-admin-password",
    "sessionTimeout": 3600000,
    "domain": "admin.localhost",
    "allowedOrigins": [
      "http://localhost:3000",
      "http://admin.localhost:3000",
      "https://admin.localhost:3000"
    ]
  }
}
```

### é…ç½®å‚æ•°è¯´æ˜

- `domain`: ç®¡ç†æ§åˆ¶å°çš„ä¸“ç”¨åŸŸå
- `allowedOrigins`: å…è®¸è®¿é—®ç®¡ç†æ§åˆ¶å°çš„æ¥æºåŸŸååˆ—è¡¨
- `password`: ç®¡ç†å‘˜ç™»å½•å¯†ç 
- `sessionTimeout`: ä¼šè¯è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. æœ¬åœ°å¼€å‘ç¯å¢ƒ

å¯åŠ¨æœåŠ¡å™¨ï¼š
```bash
npm run dev
```

è®¿é—®ç®¡ç†æ§åˆ¶å°ï¼š
- ä¸»åŸŸåï¼šhttp://localhost:3000
- ç®¡ç†åŸŸåï¼šhttp://admin.localhost:3000

**é…ç½®hostsæ–‡ä»¶ï¼ˆå¯é€‰ï¼‰ï¼š**
åœ¨ `C:\Windows\System32\drivers\etc\hosts` (Windows) æˆ– `/etc/hosts` (Linux/Mac) ä¸­æ·»åŠ ï¼š
```
127.0.0.1 admin.localhost
```

**æˆ–è€…ä½¿ç”¨curlæµ‹è¯•ï¼š**
```bash
curl -H "Host: admin.localhost:3000" http://localhost:3000/
```

### 2. ç”Ÿäº§ç¯å¢ƒ

é…ç½®DNSè®°å½•ï¼Œå°†ç®¡ç†åŸŸåæŒ‡å‘æœåŠ¡å™¨ï¼š
```
admin.yourdomain.com -> æœåŠ¡å™¨IP
```

æ›´æ–°é…ç½®æ–‡ä»¶ï¼š
```json
{
  "admin": {
    "domain": "admin.yourdomain.com",
    "allowedOrigins": [
      "https://yourdomain.com",
      "https://admin.yourdomain.com"
    ]
  }
}
```

## ğŸ” APIç«¯ç‚¹

### ç™»å½•è®¤è¯

**POST /api/admin/login**
```bash
curl -X POST http://localhost:3000/api/admin/login \
  -H "Content-Type: application/json" \
  -d '{"password":"your-password"}'
```

**DELETE /api/admin/login** - é€€å‡ºç™»å½•

**GET /api/admin/login** - éªŒè¯ä¼šè¯

### ç³»ç»ŸçŠ¶æ€

**GET /api/admin/status**
```bash
curl http://localhost:3000/api/admin/status \
  -H "Cookie: admin_session=your-session-id"
```

### é…ç½®ç®¡ç†

**GET /api/admin/config** - è·å–é…ç½®ä¿¡æ¯

**PUT /api/admin/config** - æ›´æ–°é…ç½®

**POST /api/admin/config** - é‡æ–°åŠ è½½é…ç½®

### è®¿é—®å¯†é’¥ç®¡ç†

**GET /api/admin/keys** - è·å–è®¿é—®å¯†é’¥åˆ—è¡¨

**PATCH /api/admin/keys** - åˆ‡æ¢å¯†é’¥çŠ¶æ€ï¼ˆä»…å¼€å‘æ¨¡å¼ï¼‰

## ğŸ›¡ï¸ å®‰å…¨ç‰¹æ€§

### åŸŸåéš”ç¦»

- ç®¡ç†æ§åˆ¶å°ä½¿ç”¨ç‹¬ç«‹åŸŸåï¼Œä¸ä»£ç†ç½‘ç«™å®Œå…¨éš”ç¦»
- ä¸­é—´ä»¶è‡ªåŠ¨è¯†åˆ«ç®¡ç†åŸŸåï¼Œåªå…è®¸è®¿é—®ç®¡ç†åŠŸèƒ½
- éç®¡ç†åŸŸåæ— æ³•è®¿é—®ç®¡ç†API

### ä¼šè¯ç®¡ç†

- åŸºäºå®‰å…¨çš„ä¼šè¯IDè¿›è¡Œèº«ä»½éªŒè¯
- ä¼šè¯è‡ªåŠ¨è¿‡æœŸæœºåˆ¶
- HttpOnly Cookieé˜²æ­¢XSSæ”»å‡»

### æƒé™æ§åˆ¶

- æ‰€æœ‰ç®¡ç†APIéƒ½éœ€è¦æœ‰æ•ˆçš„ç®¡ç†å‘˜ä¼šè¯
- æ•æ„Ÿé…ç½®ä¿¡æ¯åœ¨è¿”å›æ—¶ä¼šè¢«è„±æ•å¤„ç†

## ğŸ” æ•…éšœæ’é™¤

### 1. æ— æ³•è®¿é—®ç®¡ç†æ§åˆ¶å°

æ£€æŸ¥é…ç½®ï¼š
```bash
# éªŒè¯é…ç½®æ–‡ä»¶è¯­æ³•
node -e "console.log(JSON.parse(require('fs').readFileSync('config/config.json', 'utf8')))"
```

æ£€æŸ¥åŸŸåè§£æï¼š
```bash
# Windows
nslookup admin.localhost

# Linux/Mac
dig admin.localhost
```

### 2. ç™»å½•å¤±è´¥

- ç¡®è®¤ç®¡ç†å‘˜å¯†ç æ­£ç¡®
- æ£€æŸ¥ä¼šè¯æ˜¯å¦è¿‡æœŸ
- éªŒè¯Cookieè®¾ç½®

### 3. APIè¿”å›401é”™è¯¯

- ç¡®è®¤å·²æ­£ç¡®ç™»å½•
- æ£€æŸ¥ä¼šè¯Cookieæ˜¯å¦å­˜åœ¨
- éªŒè¯è¯·æ±‚åŸŸåæ˜¯å¦æ­£ç¡®

## ğŸ“ å¼€å‘è¯´æ˜

### æ·»åŠ æ–°çš„ç®¡ç†API

1. åœ¨ `src/app/api/admin/` ç›®å½•ä¸‹åˆ›å»ºæ–°çš„è·¯ç”±æ–‡ä»¶
2. ä½¿ç”¨ `verifyAdminAuth()` éªŒè¯ç®¡ç†å‘˜æƒé™
3. ä½¿ç”¨ `createSuccessResponse()` å’Œ `createErrorResponse()` è¿”å›æ ‡å‡†æ ¼å¼

### æ‰©å±•é…ç½®é€‰é¡¹

1. æ›´æ–° `AdminConfig` æ¥å£å®šä¹‰
2. ä¿®æ”¹ `ConfigManager` ç±»çš„ç›¸å…³æ–¹æ³•
3. æ›´æ–°é…ç½®æ¨¡æ¿æ–‡ä»¶

## ğŸ‰ æ€»ç»“

é€šè¿‡åŸŸåéš”ç¦»å’Œå®Œæ•´çš„APIä½“ç³»ï¼Œç®¡ç†æ§åˆ¶å°ç°åœ¨æä¾›äº†ï¼š

- âœ… ç‹¬ç«‹çš„ç®¡ç†åŸŸåï¼Œé¿å…ä¸ä»£ç†ç½‘ç«™å†²çª
- âœ… å®Œæ•´çš„èº«ä»½éªŒè¯å’Œä¼šè¯ç®¡ç†
- âœ… å®æ—¶çš„ç³»ç»ŸçŠ¶æ€ç›‘æ§
- âœ… çµæ´»çš„é…ç½®ç®¡ç†åŠŸèƒ½
- âœ… å®‰å…¨çš„è®¿é—®å¯†é’¥ç®¡ç†

è¿™ç¡®ä¿äº†ç®¡ç†åŠŸèƒ½çš„å®‰å…¨æ€§å’Œå¯ç”¨æ€§ï¼ŒåŒæ—¶ä¿æŒäº†ç³»ç»Ÿçš„æ•´ä½“æ¶æ„æ¸…æ™°ã€‚
